<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring CITES Trade Data with citesdb • rOpenSci: citesdb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../ropensci.css?nocache=123" rel="stylesheet">
<meta property="og:title" content="Exploring CITES Trade Data with citesdb">
<meta property="og:description" content="citesdb">
<meta name="twitter:card" content="summary">
<!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setCookieDomain", "*.ropensci.org"]);
  _paq.push(["setDomains", ["*.ropensci.org"]]);
  _paq.push(["setDoNotTrack", true]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://ropensci.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src='//cdn.matomo.cloud/ropensci.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
  window.addEventListener('load', function () {
    window.cookieconsent.initialise({
        'palette': {
            'popup': {
                'background': '#427fd4'
            },
            'button': {
                'background': '#fff',
                'text': '#071159'
            }
        },
        'content': {
            'header': 'Cookies used on the website!',
            'message': 'We use Matomo to analyze traffic. Cookies are stored on your browser for 13 months. This data is only processed by us.',
            'dismiss': 'Got it!',
            'allow': 'Accept',
            'deny': 'Decline',
            'link': 'Privacy policy',
            'href': 'https://ropensci.org/privacy',
            'close': '&#x274c;',
            'policy': 'Privacy Policy',
            'target': '_blank',
        },
        'type': 'opt-in',
        onInitialise: function (status) {
            var type = this.options.type
            var didConsent = this.hasConsented()
            if (type === 'opt-in' && didConsent) {
                // enable cookies
                _paq.push(['rememberConsentGiven']);
            }
            if (type == 'opt-out' && !didConsent) {
                // disable cookies
                _paq.push(['forgetConsentGiven']);
            }
        },

        onStatusChange: function (status, chosenBefore) {
            var type = this.options.type
            var didConsent = this.hasConsented()
            if (type === 'opt-in' && didConsent) {
                // enable cookies
                _paq.push(['rememberConsentGiven']);
            }
            if (type == 'opt-out' && !didConsent) {
                // disable cookies
                _paq.push(['forgetConsentGiven'], 24);
            }
        },

        onRevokeChoice: function () {
            var type = this.options.type
            if (type === 'opt-in') {
                // disable cookies
                _paq.push(['forgetConsentGiven']);
            }
            if (type == 'opt-out' && !didConsent) {
                // disable cookies
                _paq.push(['forgetConsentGiven'], 24);
            }
        }
    })
})

</script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
        <a class="navbar-brand" href="../index.html"><i>citesdb <small>v0.2.0</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/exploring-cites-trade-data-with-citesdb.html">Exploring CITES Trade Data with citesdb</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ropensci/citesdb/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right docsearch" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploring CITES Trade Data with citesdb</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/citesdb/blob/master/vignettes/exploring-cites-trade-data-with-citesdb.Rmd"><code>vignettes/exploring-cites-trade-data-with-citesdb.Rmd</code></a></small>
      <div class="hidden name"><code>exploring-cites-trade-data-with-citesdb.Rmd</code></div>

    </div>

    
    
<p><strong>citesdb</strong> is an R package to conveniently analyze the full CITES shipment-level wildlife trade database, available at <a href="https://trade.cites.org/" class="uri">https://trade.cites.org/</a>. This data consists of over 40 years and 20 million records of reported shipments of wildlife and wildlife products subject to oversight under the <a href="https://www.cites.org">Convention on International Trade in Endangered Species of Wild Fauna and Flora</a>. The source data are maintained by the <a href="https://www.unep-wcmc.org/">UN Environment World Conservation Monitoring Centre</a>. <span class="citation">Harfoot et al. (<a href="#ref-Harfoot_2018">2018</a>)</span> provide a recent overview of broad temporal and spatial trends in the data.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Install the <strong>citesdb</strong> package with this command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"ropensci/citesdb"</span><span class="op">)</span></pre></div>
<p>Note that since <strong>citesdb</strong> installs a source dependency from GitHub, you will need <a href="http://stat545.com/packages01_system-prep.html">package build tools</a>.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div id="getting-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-the-data" class="anchor"></a>Getting the data</h3>
<p>When you first load the package you will see a message like this:</p>
<pre><code><a href="https://docs.ropensci.org/citesdb">library(citesdb)
#&gt; Local CITES database empty or corrupt. Download with cites_db_download()</a></code></pre>
<p>Not to worry, just do as it says and run <code><a href="../reference/cites_db_download.html">cites_db_download()</a></code>. This will fetch the most recent<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> database from online, an approximately 158 MB download. It will expand to over 1 GB in the local database. During the download and database building, up to 3.5 GB of disk space may be used temporarily.</p>
</div>
<div id="using-the-database-for-basic-analyses" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-database-for-basic-analyses" class="anchor"></a>Using the database for basic analyses</h3>
<p>Once you fetch the data you can connect to the database with the <code><a href="../reference/cites_db.html">cites_db()</a></code> command. You can use the <code><a href="../reference/cites_shipments.html">cites_shipments()</a></code> command to load a remote <code>tibble</code> that is backed by the database but not loaded into R. You can use this to analyze CITES data without ever loading it into memory, then gather your results with the <code>dplyr</code> function <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code>. For example, as demonstrated in the package README file, one could compute the number of shipment records per year like so:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/citesdb">citesdb</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>

<span class="fu"><a href="../reference/cites_shipments.html">cites_shipments</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_records <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 44 x 2</span>
<span class="co">#&gt;     Year n_records</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2018      1326</span>
<span class="co">#&gt;  2  2017   1015719</span>
<span class="co">#&gt;  3  2016   1262632</span>
<span class="co">#&gt;  4  2015   1296532</span>
<span class="co">#&gt;  5  2014   1109872</span>
<span class="co">#&gt;  6  2013   1127363</span>
<span class="co">#&gt;  7  2012   1096645</span>
<span class="co">#&gt;  8  2011    950144</span>
<span class="co">#&gt;  9  2010    894011</span>
<span class="co">#&gt; 10  2009    908669</span>
<span class="co">#&gt; # … with 34 more rows</span></pre></div>
<p>(<em>Note that running <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code> on all of <code><a href="../reference/cites_shipments.html">cites_shipments()</a></code> will load a &gt;3 GB data frame into memory!</em>)</p>
<p>Alternatively, one could visualize the same information by piping results from a <code><a href="../reference/cites_shipments.html">cites_shipments()</a></code> call directly into <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1975</span>, to <span class="op">=</span> <span class="fl">2020</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="fu"><a href="../reference/cites_shipments.html">cites_shipments</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_records <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>log10_n_records <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">n_records</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">n_records</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of Records"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span><span class="op">)</span></pre></div>
<p><img src="exploring-cites-trade-data-with-citesdb_files/figure-html/unnamed-chunk-4-1.png" width="624" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit">

<span class="fu"><a href="../reference/cites_shipments.html">cites_shipments</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_records <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>log10_n_records <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">n_records</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">log10_n_records</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"log10(Number of Records)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">6.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span><span class="op">)</span></pre></div>
<p><img src="exploring-cites-trade-data-with-citesdb_files/figure-html/unnamed-chunk-4-2.png" width="624" style="display: block; margin: auto;"></p>
</div>
<div id="metadata" class="section level3">
<h3 class="hasAnchor">
<a href="#metadata" class="anchor"></a>Metadata</h3>
<p>The package database also contains tables of field metadata, codes used, and CITES countries. This information comes from <a href="https://trade.cites.org/cites_trade_guidelines/en-CITES_Trade_Database_Guide.pdf">“A guide to using the CITES Trade Database”</a>, on the CITES website. Convenience functions <code><a href="../reference/cites_metadata.html">cites_metadata()</a></code>, <code><a href="../reference/cites_metadata.html">cites_codes()</a></code>, and <code><a href="../reference/cites_metadata.html">cites_parties()</a></code> access this information:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/cites_metadata.html">cites_metadata</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   variable description                                 </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;                                       </span>
<span class="co">#&gt; 1 Year     year in which trade occurred                </span>
<span class="co">#&gt; 2 Appendix CITES Appendix of taxon concerned           </span>
<span class="co">#&gt; 3 Taxon    scientific name of animal or plant concerned</span>
<span class="co">#&gt; 4 Class    scientific name of animal or plant concerned</span>
<span class="co">#&gt; 5 Order    scientific name of animal or plant concerned</span>
<span class="co">#&gt; 6 Family   scientific name of animal or plant concerned</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/cites_metadata.html">cites_codes</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   field   code  description                                    </span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;                                          </span>
<span class="co">#&gt; 1 Purpose B     Breeding in captivity or artificial propagation</span>
<span class="co">#&gt; 2 Purpose E     Educational                                    </span>
<span class="co">#&gt; 3 Purpose G     Botanical garden                               </span>
<span class="co">#&gt; 4 Purpose H     Hunting trophy                                 </span>
<span class="co">#&gt; 5 Purpose L     Law enforcement / judicial / forensic          </span>
<span class="co">#&gt; 6 Purpose M     Medical (including biomedical research)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/cites_metadata.html">cites_parties</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   country        code  former_code non_ISO_code date       data_source                                                  </span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt; &lt;lgl&gt;       &lt;lgl&gt;        &lt;chr&gt;      &lt;chr&gt;                                                        </span>
<span class="co">#&gt; 1 Afghanistan    AF    FALSE       FALSE        1986-01-28 'A guide to using the CITES Trade Database', Version 8, Anne…</span>
<span class="co">#&gt; 2 Africa         XF    FALSE       TRUE         &lt;NA&gt;       'A guide to using the CITES Trade Database', Version 8, Anne…</span>
<span class="co">#&gt; 3 Åland Islands  AX    FALSE       FALSE        &lt;NA&gt;       'A guide to using the CITES Trade Database', Version 8, Anne…</span>
<span class="co">#&gt; 4 Albania        AL    FALSE       FALSE        2003-09-25 'A guide to using the CITES Trade Database', Version 8, Anne…</span>
<span class="co">#&gt; 5 Algeria        DZ    FALSE       FALSE        1984-02-21 'A guide to using the CITES Trade Database', Version 8, Anne…</span>
<span class="co">#&gt; 6 American Samoa AS    FALSE       FALSE        &lt;NA&gt;       'A guide to using the CITES Trade Database', Version 8, Anne…</span></pre></div>
<p>More information on the release of shipment-level data can be found in the <code><a href="../reference/guidance.html">?guidance</a></code> help file.</p>
</div>
</div>
<div id="direct-database-connection" class="section level2">
<h2 class="hasAnchor">
<a href="#direct-database-connection" class="anchor"></a>Direct Database Connection</h2>
<p><strong>citesdb</strong> stores data in an on-disk <a href="https://www.monetdb.org/">MonetDB</a> SQL database. If you want to use SQL commands for complex queries or otherwise want to directly access the database connection, use the <code><a href="../reference/cites_db.html">cites_db()</a></code> command:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cites_db.html">cites_db</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html">dbListTables</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span>
<span class="co">#&gt; [1] "cites_codes"     "cites_metadata"  "cites_parties"   "cites_shipments" "cites_status"</span></pre></div>
<p>Note that MonetDB, as implemented by the <a href="https://github.com/MonetDB/MonetDBLite-R/">MonetDBLite</a> package, currently has a limitation of only one connection to the database at a time. Therefore, if you are running R in multiple sessions (say, one in a console and separately knitting an R Markdown document), you will receive this error:</p>
<pre><code>Error: Local citesdb database is locked by another R session.
 Try closing or running cites_disconnect() in that session.</code></pre>
<p><code><a href="../reference/cites_disconnect.html">cites_disconnect()</a></code> shuts down the current connection, freeing up your other session to connect.</p>
<p>If you are using a recent version of RStudio interactively, loading the <code>citesdb</code> package also brings up a browsable pane in the “Connections” tab that lets you explore and preview the database tables.</p>
<p><img src="figures/cites_pane.gif"></p>
<p>Click on the arrows to see the data types in each table, or the table icon to the right for a preview of the table. The <strong>SQL</strong> button (which appears in RStudio &gt;=1.2) opens an SQL document to <a href="https://blog.rstudio.com/2018/10/02/rstudio-1-2-preview-sql/">write and preview SQL queries directly</a>.</p>
</div>
<div id="cites-metadata-with-rcites" class="section level2">
<h2 class="hasAnchor">
<a href="#cites-metadata-with-rcites" class="anchor"></a>CITES Metadata with <code>rcites</code>
</h2>
<p>Suppose we were interested in CITES data on sharks from the order Lamniformes. We might begin an analysis by visualizing shipments of these organisms and their derived products over time:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="../reference/cites_shipments.html">cites_shipments</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Order</span> <span class="op">==</span> <span class="st">"Lamniformes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Taxon</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_records <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">n_records</span>, color <span class="op">=</span> <span class="va">Taxon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of Records"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="exploring-cites-trade-data-with-citesdb_files/figure-html/unnamed-chunk-7-1.png" width="624" style="display: block; margin: auto;"></p>
<p>What accounts for the temporal differences in the number of CITES records we observe? Why are there no data prior to 2001? It would be helpful to know more about the history of these particular species within CITES.</p>
<p>Fortunately, the <a href="https://github.com/ropensci/rcites"><strong>rcites</strong></a> package provides access to the Speciesplus/CITES Checklist API, which includes metadata about species and their protected status through time. To use the functions within this package, users will first need to <a href="https://api.speciesplus.net/users/sign_up">sign up for a Speciesplus API account</a> in order to generate a personal access token. This token can then be set for the current R session using <code><a href="https://docs.ropensci.org/rcites/reference/set_token.html">rcites::set_token()</a></code> or can be stored permanently if written to the user’s <code>.Renviron</code> file (the approach taken in this tutorial). See <a href="https://docs.ropensci.org/rcites/articles/a_get_started.html">here</a> for more information on use of the API access tokens.</p>
<p>As an initial step in <code>rcites</code> workflows, it will typically be most useful to call <code><a href="https://docs.ropensci.org/rcites/reference/spp_taxonconcept.html">spp_taxonconcept()</a></code> on some taxa of interest. Using the specific example of one of our Lamniformes sharks, the great white (<em>Carcharodon carcharias</em>), as a query taxon, we can see that this function returns a variety of information:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rcites/">rcites</a></span><span class="op">)</span>

<span class="fu"><a href="https://docs.ropensci.org/rcites/reference/spp_taxonconcept.html">spp_taxonconcept</a></span><span class="op">(</span>query_taxon <span class="op">=</span> <span class="st">"Carcharodon carcharias"</span><span class="op">)</span><span class="op">$</span><span class="va">general</span><span class="op">$</span><span class="va">id</span></pre></div>
<pre><code>#&gt; [1] "11210"</code></pre>
<p>Importantly, we can collect the ID for our taxon of interest from this output and store it as an object for ease of reference:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">great_white_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rcites/reference/spp_taxonconcept.html">spp_taxonconcept</a></span><span class="op">(</span><span class="st">"Carcharodon carcharias"</span><span class="op">)</span><span class="op">$</span><span class="va">general</span><span class="op">$</span><span class="va">id</span></pre></div>
<p>Using our stored ID variable, we can query other <code>rcites</code> functions like <code><a href="https://docs.ropensci.org/rcites/reference/spp_cites_legislation.html">spp_cites_legislation()</a></code>, which returns the CITES listing and reservation status for the query taxon. Note that <a href="https://www.cites.org/eng/app/reserve_intro.php">reservations</a> are essentially exemptions declared by particular CITES Parties in reference to specific taxa.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://docs.ropensci.org/rcites/reference/spp_cites_legislation.html">spp_cites_legislation</a></span><span class="op">(</span><span class="va">great_white_id</span><span class="op">)</span><span class="op">$</span><span class="va">cites_listings</span></pre></div>
<pre><code>#&gt; # A tibble: 4 x 6
#&gt;   id    taxon_concept_id is_current appendix change_type effective_at
#&gt;   &lt;chr&gt; &lt;chr&gt;            &lt;lgl&gt;      &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;       
#&gt; 1 904   11210            TRUE       II       +           2005-01-12  
#&gt; 2 906   11210            TRUE       II       R+          2005-01-12  
#&gt; 3 907   11210            TRUE       II       R+          2005-01-12  
#&gt; 4 905   11210            TRUE       II       R+          2005-01-12</code></pre>
<p>So this function query reveals that the great white is listed under CITES Appendix II (as of 12 January 2005) and that three CITES Parties have active reservations for this species.</p>
<p>To reveal the full listing and reservation history, rather than just current information, we use the <code>scope = "all"</code> argument:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="fu"><a href="https://docs.ropensci.org/rcites/reference/spp_cites_legislation.html">spp_cites_legislation</a></span><span class="op">(</span><span class="va">great_white_id</span>, scope <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span><span class="op">$</span><span class="va">cites_listings</span></pre></div>
<pre><code>#&gt; # A tibble: 13 x 6
#&gt;    id    taxon_concept_id is_current appendix change_type effective_at
#&gt;    &lt;chr&gt; &lt;chr&gt;            &lt;lgl&gt;      &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;       
#&gt;  1 899   11210            FALSE      III      +           2001-10-29  
#&gt;  2 904   11210            TRUE       II       +           2005-01-12  
#&gt;  3 898   11210            FALSE      III      R+          2001-10-22  
#&gt;  4 900   11210            FALSE      III      R+          2002-03-26  
#&gt;  5 901   11210            FALSE      II       R+          2004-07-15  
#&gt;  6 902   11210            FALSE      III      R+          2004-07-15  
#&gt;  7 906   11210            TRUE       II       R+          2005-01-12  
#&gt;  8 907   11210            TRUE       II       R+          2005-01-12  
#&gt;  9 905   11210            TRUE       II       R+          2005-01-12  
#&gt; 10 22005 11210            FALSE      III      R-          2005-01-12  
#&gt; 11 22003 11210            FALSE      III      R-          2005-01-12  
#&gt; 12 22004 11210            FALSE      III      R-          2005-01-12  
#&gt; 13 23783 11210            FALSE      II       R-          2016-11-21</code></pre>
<p>Here, we see that the species was in fact listed under CITES Appendix III as early as 29 October 2001. This may account for the CITES trade records for this species that date prior to its uplisting to Appendix II, a status which affords more stringent protection and monitoring.</p>
<p>In general, the historical listing information provides critical context for CITES data interpretation. In this case, for instance, it is clear that the lack of CITES data for great white sharks prior to the year 2002 should not be taken as an indication of a lack of trade in this species during that time frame but rather a lack of intergovernmental oversight and data collection.</p>
<p><code>rcites</code> also offers functions that return other useful metadata such as species distribution information:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="fu"><a href="https://docs.ropensci.org/rcites/reference/spp_distributions.html">spp_distributions</a></span><span class="op">(</span><span class="va">great_white_id</span><span class="op">)</span><span class="op">$</span><span class="va">distributions</span></pre></div>
<pre><code>#&gt; # A tibble: 96 x 5
#&gt;    id    iso_code2 name                      type      tags 
#&gt;    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;                     &lt;chr&gt;     &lt;chr&gt;
#&gt;  1 14    BS        Bahamas                   COUNTRY   ""   
#&gt;  2 101   TW        Taiwan, Province of China TERRITORY ""   
#&gt;  3 1315  TR        Turkey                    COUNTRY   ""   
#&gt;  4 1704  GH        Ghana                     COUNTRY   ""   
#&gt;  5 5041  CV        Cabo Verde                COUNTRY   ""   
#&gt;  6 5393  HR        Croatia                   COUNTRY   ""   
#&gt;  7 6460  GA        Gabon                     COUNTRY   ""   
#&gt;  8 8056  MA        Morocco                   COUNTRY   ""   
#&gt;  9 8181  ES        Spain                     COUNTRY   ""   
#&gt; 10 8286  SD        Sudan                     COUNTRY   ""   
#&gt; # … with 86 more rows</code></pre>
<p>More in-depth description of <code>rcites</code> and usage tutorials can be found via the package <a href="http://joss.theoj.org/papers/10.21105/joss.01091">publication</a> and <a href="https://docs.ropensci.org/rcites/">website</a>.</p>
</div>
<div id="pitfalls-of-working-with-cites-trade-data" class="section level2">
<h2 class="hasAnchor">
<a href="#pitfalls-of-working-with-cites-trade-data" class="anchor"></a>Pitfalls of Working with CITES Trade Data</h2>
<p>The CITES shipment-level data is a valuable resource for understanding part of the global wildlife trade. However, care must be taken in working with this data. Incomplete or ambiguous data can lead to misinterpretation and different approaches to handling the data can lead to different conclusions. <span class="citation">Harrington (<a href="#ref-Harrington_2015">2015</a>)</span>, <span class="citation">Berec, Vršecká, and Šetlíková (<a href="#ref-Berec_2018">2018</a>)</span>, <span class="citation">Robinson and Sinovas (<a href="#ref-Robinson_2018">2018</a>)</span>, and <span class="citation">Eskew et al. (<a href="#ref-Eskew_2019">2019</a>)</span> all provide greater detail on challenges related to analyzing the CITES Trade Database. Also note the shipment-level guidance provided by CITES, which can be found in the <code><a href="../reference/guidance.html">?guidance</a></code> help file.</p>
<p>As an example, single shipments may be recorded multiple times, as they may be reported by both exporting and importing countries. Here we examine a set of shipments of orchids from a US exporter to the Netherlands:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu"><a href="../reference/cites_shipments.html">cites_shipments</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2016</span>, <span class="va">Export.permit.RandomID</span> <span class="op">==</span> <span class="st">"ce63001ff5"</span>, <span class="va">Genus</span> <span class="op">==</span> <span class="st">"Paphiopedilum"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="3%">
<col width="12%">
<col width="2%">
<col width="4%">
<col width="5%">
<col width="6%">
<col width="2%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="6%">
<col width="10%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="right">Year</th>
<th align="left">Appendix</th>
<th align="left">Taxon</th>
<th align="left">Class</th>
<th align="left">Order</th>
<th align="left">Family</th>
<th align="left">Genus</th>
<th align="left">Term</th>
<th align="right">Quantity</th>
<th align="left">Unit</th>
<th align="left">Importer</th>
<th align="left">Exporter</th>
<th align="left">Origin</th>
<th align="left">Purpose</th>
<th align="left">Source</th>
<th align="left">Reporter.type</th>
<th align="left">Import.permit.RandomID</th>
<th align="left">Export.permit.RandomID</th>
<th align="left">Origin.permit.RandomID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum appletonianum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">2</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum appletonianum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">2</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">E</td>
<td align="left">NA</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum armeniacum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum armeniacum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">E</td>
<td align="left">NA</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum callosum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">3</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum callosum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">3</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">E</td>
<td align="left">NA</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>See that each pair of shipments is identical except for <code>Reporter.type</code>, indicating that the shipment was reported both from the US and from the Netherlands. Note that while the importer reported both import and export permit numbers, the exporter reported only the export permit numbers.</p>
<p>How to deal with repeat records? If you are aggregating records to calculate total shipments it is best to remove them, but not every record is recorded twice. This code filters to use only the importer’s records, should all fields other than <code>Reporter.type</code> and <code>Import.permit.RandomID</code> be the same:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="fu"><a href="../reference/cites_shipments.html">cites_shipments</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2016</span>, <span class="va">Export.permit.RandomID</span> <span class="op">==</span> <span class="st">"ce63001ff5"</span>, <span class="va">Genus</span> <span class="op">==</span> <span class="st">"Paphiopedilum"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="op">-</span><span class="va">Reporter.type</span>, <span class="op">-</span><span class="va">Import.permit.RandomID</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">Reporter.type</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span> <span class="op">|</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="3%">
<col width="12%">
<col width="2%">
<col width="4%">
<col width="5%">
<col width="6%">
<col width="2%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="6%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="1%">
</colgroup>
<thead><tr class="header">
<th align="right">Year</th>
<th align="left">Appendix</th>
<th align="left">Taxon</th>
<th align="left">Class</th>
<th align="left">Order</th>
<th align="left">Family</th>
<th align="left">Genus</th>
<th align="left">Term</th>
<th align="right">Quantity</th>
<th align="left">Unit</th>
<th align="left">Importer</th>
<th align="left">Exporter</th>
<th align="left">Origin</th>
<th align="left">Purpose</th>
<th align="left">Source</th>
<th align="left">Reporter.type</th>
<th align="left">Import.permit.RandomID</th>
<th align="left">Export.permit.RandomID</th>
<th align="left">Origin.permit.RandomID</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum appletonianum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">2</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum armeniacum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum callosum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">3</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum charlesworthii</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">2</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum concolor</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="left">I</td>
<td align="left">Paphiopedilum dayanum</td>
<td align="left">NA</td>
<td align="left">Orchidales</td>
<td align="left">Orchidaceae</td>
<td align="left">Paphiopedilum</td>
<td align="left">live</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">DE</td>
<td align="left">US</td>
<td align="left">NA</td>
<td align="left">T</td>
<td align="left">D</td>
<td align="left">I</td>
<td align="left">e75ff00c16</td>
<td align="left">ce63001ff5</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="citation" class="section level2">
<h2 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h2>
<p>If you use <strong>citesdb</strong> in a publication, please cite both the package and source data:</p>
<p>Ross, Noam, Evan A. Eskew, and Nicolas Ray. 2019. citesdb: An R package to support analysis of CITES Trade Database shipment-level data. Journal of Open Source Software, 4(37), 1483, <a href="https://doi.org/10.21105/joss.01483" class="uri">https://doi.org/10.21105/joss.01483</a></p>
<p>UNEP-WCMC (Comps.) 2019. Full CITES Trade Database Download. Version 2019.2. CITES Secretariat, Geneva, Switzerland. Compiled by UNEP-WCMC, Cambridge, UK. Available at: <a href="https://trade.cites.org" class="uri">https://trade.cites.org</a>.</p>
</div>
<div id="contributing" class="section level2">
<h2 class="hasAnchor">
<a href="#contributing" class="anchor"></a>Contributing</h2>
<p>Have feedback or want to contribute? Great! Please take a look at the <a href="https://github.com/ropensci/citesdb/blob/master/.github/CONTRIBUTING.md">contributing guidelines</a> before filing an issue or pull request.</p>
<p>Please note that this project is released with a <a href="https://github.com/ropensci/citesdb/blob/master/.github/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs">
<div id="ref-Berec_2018">
<p>Berec, Michal, Lucie Vršecká, and Irena Šetlíková. 2018. “What Is the Reality of Wildlife Trade Volume? CITES Trade Database Limitations.” <em>Biological Conservation</em> 224: 111–16. <a href="https://doi.org/10.1016/j.biocon.2018.05.025">https://doi.org/10.1016/j.biocon.2018.05.025</a>.</p>
</div>
<div id="ref-Eskew_2019">
<p>Eskew, Evan A., Noam Ross, Carlos Zambrana-Torrelio, and William B. Karesh. 2019. “The CITES Trade Database Is Not a "Global Snapshot" of Legal Wildlife Trade: Response to Can et al., 2019.” <em>Global Ecology and Conservation</em> 18: e00631. <a href="https://doi.org/10.1016/j.gecco.2019.e00631">https://doi.org/10.1016/j.gecco.2019.e00631</a>.</p>
</div>
<div id="ref-Harfoot_2018">
<p>Harfoot, Michael, Satu A. M. Glaser, Derek P. Tittensor, Gregory L. Britten, Claire McLardy, Kelly Malsch, and Neil D. Burgess. 2018. “Unveiling the Patterns and Trends in 40 Years of Global Trade in CITES-Listed Wildlife.” <em>Biological Conservation</em> 223: 47–57. <a href="https://doi.org/10.1016/j.biocon.2018.04.017">https://doi.org/10.1016/j.biocon.2018.04.017</a>.</p>
</div>
<div id="ref-Harrington_2015">
<p>Harrington, Lauren A. 2015. “International Commercial Trade in Live Carnivores and Primates 2006-2012: Response to Bush et al. 2014.” <em>Conservation Biology</em> 29: 293–96. <a href="https://doi.org/10.1111/cobi.12448">https://doi.org/10.1111/cobi.12448</a>.</p>
</div>
<div id="ref-Robinson_2018">
<p>Robinson, Janine E., and Pablo Sinovas. 2018. “Challenges of Analyzing the Global Trade in CITES-Listed Wildlife.” <em>Conservation Biology</em> 32: 1203–6. <a href="https://doi.org/10.1111/cobi.13095">https://doi.org/10.1111/cobi.13095</a>.</p>
</div>
</div>
<p><a href="https://www.ecohealthalliance.org/"><img src="figures/eha-footer.png" alt="Created by EcoHealth Alliance"></a></p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>When data is updated on the CITES website, we check for changes in structure, metadata, or documentation that we should pass on to the user (e.g., in the <code><a href="../reference/guidance.html">?guidance</a></code> help file) and re-package the data for distribution in our own repository. Data updates are expected twice per year, and we expect our repository to update within 2 weeks of the official release.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/ropensci" target="_blank"><div class="icon fab fa-github"></div></a>
                        <a href="http://github.com/ropenscilabs" target="_blank"><div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/ropensci" target="_blank"><div class="icon fab fa-twitter"></div></a>
                        <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review">Software Review Process</a></li>
                            <li><a href="https://ropensci.org/about#team">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate">Donate</a></li>
                            <li><a href="https://ropensci.org/contact">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/">Documentation</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                        <a href="http://numfocus.org" target="_blank"></a>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '799829e946e1f0f9cd5b5a782c6316b9',
    indexName: 'ropensci-citesdb',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
